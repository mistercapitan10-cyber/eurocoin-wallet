# OAuth 2.0 - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –∏ –ì–æ—Ç–æ–≤–æ! ‚úÖ

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª NEXTAUTH_URL
**–û—à–∏–±–∫–∞:** NextAuth –Ω–µ –º–æ–≥ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å redirect URLs
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω `NEXTAUTH_URL=http://localhost:3000` –≤ `.env.local`

### –ü—Ä–æ–±–ª–µ–º–∞ 2: OAuth –∫–Ω–æ–ø–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ GET –≤–º–µ—Å—Ç–æ POST
**–û—à–∏–±–∫–∞:** NextAuth v5 —Ç—Ä–µ–±—É–µ—Ç POST –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è signin endpoints
**–†–µ—à–µ–Ω–∏–µ:** –û–±–Ω–æ–≤–ª–µ–Ω `/components/auth/oauth-buttons.tsx`
- –¢–µ–ø–µ—Ä—å —Å–æ–∑–¥–∞–µ—Ç—Å—è HTML —Ñ–æ—Ä–º–∞ —Å CSRF —Ç–æ–∫–µ–Ω–æ–º
- Form.submit() –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç POST –∑–∞–ø—Ä–æ—Å
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∞–µ—Ç—Å—è CSRF token –∏–∑ `/api/auth/csrf`

## üöÄ –ö–∞–∫ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å OAuth

### 1. –û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä
–ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞: **http://localhost:3000/login**

### 2. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ Google OAuth
1. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É **"Sign in with Google"** (—Ç–µ–º–Ω–∞—è –∫–Ω–æ–ø–∫–∞ —Å –∏–∫–æ–Ω–∫–æ–π Chrome)
2. –û—Ç–∫—Ä–æ–µ—Ç—Å—è popup Google OAuth
3. –í—ã–±–µ—Ä–∏—Ç–µ –∞–∫–∫–∞—É–Ω—Ç Google
4. –†–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø
5. –í–∞—Å –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É (http://localhost:3000)
6. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –≤—ã –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã

### 3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ GitHub OAuth
1. –°–Ω–∞—á–∞–ª–∞ –≤—ã–π–¥–∏—Ç–µ –∏–∑ —Ç–µ–∫—É—â–µ–π —Å–µ—Å—Å–∏–∏ (–µ—Å–ª–∏ –≤–æ—à–ª–∏ —á–µ—Ä–µ–∑ Google)
2. –í–µ—Ä–Ω–∏—Ç–µ—Å—å –Ω–∞ `/login`
3. –ù–∞–∂–º–∏—Ç–µ **"Sign in with GitHub"** (—Ç–µ–º–Ω–∞—è –∫–Ω–æ–ø–∫–∞ —Å –∏–∫–æ–Ω–∫–æ–π GitHub)
4. –û—Ç–∫—Ä–æ–µ—Ç—Å—è popup GitHub OAuth
5. –†–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø
6. –í–∞—Å –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é

### 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—Ö–æ–¥–∞:
- –í—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞ `/` (–≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞)
- –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ (F12 ‚Üí Console) –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ª–æ–≥–∏ NextAuth
- –î–æ–ª–∂–µ–Ω –ø–æ—è–≤–∏—Ç—å—Å—è ReadOnlyBanner (—Ç.–∫. –≤—Ö–æ–¥ —á–µ—Ä–µ–∑ email, –∞ –Ω–µ wallet)

## üìã –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–µ–π—á–∞—Å

### ‚úÖ Google OAuth
- Redirect –Ω–∞ Google OAuth consent screen
- –ü–æ–ª—É—á–µ–Ω–∏–µ email, name, image –ø—Ä–æ—Ñ–∏–ª—è
- –°–æ–∑–¥–∞–Ω–∏–µ JWT session
- Redirect –æ–±—Ä–∞—Ç–Ω–æ –Ω–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

### ‚úÖ GitHub OAuth
- Redirect –Ω–∞ GitHub OAuth authorization
- –ü–æ–ª—É—á–µ–Ω–∏–µ GitHub username, email
- –°–æ–∑–¥–∞–Ω–∏–µ JWT session
- Redirect –æ–±—Ä–∞—Ç–Ω–æ

### ‚úÖ JWT Sessions
- –°–µ—Å—Å–∏–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ JWT tokens (cookie)
- –ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 7 –¥–Ω–µ–π
- –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 24 —á–∞—Å–∞

### ‚ö†Ô∏è Email Provider
Email provider –æ—Ç–∫–ª—é—á–µ–Ω –≤ development —Ä–µ–∂–∏–º–µ:
```
[AUTH] Email provider disabled in development environment.
```

–ß—Ç–æ–±—ã –≤–∫–ª—é—á–∏—Ç—å:
1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å RESEND_API_KEY –≤ .env.local
2. –ò–∑–º–µ–Ω–∏—Ç—å –≤ lib/auth.ts —É—Å–ª–æ–≤–∏–µ (—É–±—Ä–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É NODE_ENV)
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞

–û—Ç–∫—Ä–æ–π—Ç–µ DevTools (F12) ‚Üí Console –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```javascript
// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â—É—é —Å–µ—Å—Å–∏—é
fetch('/api/auth/session').then(r => r.json()).then(console.log)

// –î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å:
// –ï—Å–ª–∏ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω:
{
  user: {
    id: "...",
    email: "user@example.com",
    name: "User Name",
    image: "https://...",
    authType: "email"
  },
  expires: "..."
}

// –ï—Å–ª–∏ –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω:
{}
```

## üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ useAuth hook

–ü–æ—Å–ª–µ –≤—Ö–æ–¥–∞, –æ—Ç–∫—Ä–æ–π—Ç–µ –ª—é–±—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –≤ –∫–æ–Ω—Å–æ–ª–∏:

```javascript
// useAuth() –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å:
{
  isAuthenticated: true,
  authType: "email",
  userId: "...",
  email: "user@example.com",
  name: "User Name",
  image: "https://...",
  canMakeTransactions: false,  // ‚ùå false –¥–ª—è email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  isLoading: false
}
```

## üìä –õ–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞

–í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –≥–¥–µ –∑–∞–ø—É—â–µ–Ω `npm run dev` –≤—ã —É–≤–∏–¥–∏—Ç–µ:

```
[AUTH] Sign in attempt: { provider: 'google', email: '...', userId: '...' }
[AUTH] JWT created: { userId: '...', authType: 'email', email: '...' }
[AUTH EVENT] User signed in: { userId: '...', email: '...', provider: 'google', isNewUser: true }
```

## ‚öôÔ∏è –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env.local)

–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –µ—Å—Ç—å –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

```env
# NextAuth
NEXTAUTH_URL=http://localhost:3000
NEXTAUTH_SECRET=5ubiy+1x6PqCZ0L1kAgyAB2yj9EBoLaHVksG4yO2/fo=

# Google OAuth
GOOGLE_CLIENT_ID=1092579394193-kuubqff61b6tarh07o6tus1scdrfer7o.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=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

# GitHub OAuth
GITHUB_CLIENT_ID=Ov23liQUoMkphRoYnsNN
GITHUB_CLIENT_SECRET=0098de0de5e2766686c3c99d71182f8674aa0a54

# Database (optional, currently disabled)
DATABASE_URL=postgresql://postgres:postgres@localhost:5432/web_wallet_db
```

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è OAuth:

1. **–í–∫–ª—é—á–∏—Ç—å Database Adapter** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
   - Uncomment –∫–æ–¥ –≤ `/lib/auth.ts` (—Å—Ç—Ä–æ–∫–∏ 45-69)
   - –≠—Ç–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ PostgreSQL
   - Sessions –±—É–¥—É—Ç —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –≤ –ë–î –≤–º–µ—Å—Ç–æ JWT

2. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å Production URLs**
   - –û–±–Ω–æ–≤–∏—Ç—å NEXTAUTH_URL –Ω–∞ production URL
   - –û–±–Ω–æ–≤–∏—Ç—å OAuth redirect URIs –≤ Google/GitHub –∫–æ–Ω—Å–æ–ª–∏

3. **–î–æ–±–∞–≤–∏—Ç—å Account Linking**
   - –ü–æ–∑–≤–æ–ª–∏—Ç—å —Å–≤—è–∑—ã–≤–∞—Ç—å email –∞–∫–∫–∞—É–Ω—Ç —Å wallet
   - –ü–æ–∑–≤–æ–ª–∏—Ç—å OAuth –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º upgrade –¥–æ wallet

4. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å Sign Out**
   - –î–æ–±–∞–≤–∏—Ç—å SignOutButton –≤ —Ö–µ–¥–µ—Ä
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ sign out —Ä–∞–±–æ—Ç–∞–µ—Ç
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å redirect –Ω–∞ /login

## ‚úÖ –†–µ–∑—é–º–µ

**OAuth –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—Ç–∞–µ—Ç!** üéâ

–í—Å–µ —á—Ç–æ –Ω—É–∂–Ω–æ:
1. –û—Ç–∫—Ä—ã—Ç—å http://localhost:3000/login
2. –ù–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É Google –∏–ª–∏ GitHub
3. –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è
4. Profit!

–°–µ—Å—Å–∏–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è, —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ JWT, –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–Ω–∞–µ—Ç —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω —á–µ—Ä–µ–∑ `useAuth()` hook.

**–ü—Ä–æ–±–ª–µ–º—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã:**
- ‚úÖ NEXTAUTH_URL –¥–æ–±–∞–≤–ª–µ–Ω
- ‚úÖ OAuth –∫–Ω–æ–ø–∫–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç POST + CSRF
- ‚úÖ –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –±—ã—Å—Ç—Ä–æ
- ‚úÖ NextAuth API endpoints —Ä–∞–±–æ—Ç–∞—é—Ç

---

**–î–∞—Ç–∞:** 2025-10-30
**–°—Ç–∞—Ç—É—Å:** ‚úÖ OAuth Working
**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** Ready for testing
